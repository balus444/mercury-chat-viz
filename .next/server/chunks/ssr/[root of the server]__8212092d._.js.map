{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/balasubramanian/Desktop/mercury-ai-genie/lib/types.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport type Unicorn = {\n  id: number;\n  company: string;\n  valuation: number;\n  date_joined: Date | null;\n  country: string;\n  city: string;\n  industry: string;\n  select_investors: string;\n};\n\nexport type Result = Record<string, string | number>;\n\nexport const explanationSchema = z.object({\n  section: z.string(),\n  explanation: z.string(),\n});\nexport const explanationsSchema = z.array(explanationSchema);\n\nexport type QueryExplanation = z.infer<typeof explanationSchema>;\n\n// Define the schema for chart configuration\nexport const configSchema = z\n  .object({\n    description: z\n      .string()\n      .describe(\n        \"Describe the chart. What is it showing? What is interesting about the way the data is displayed?\",\n      ),\n    takeaway: z.string().describe(\"What is the main takeaway from the chart?\"),\n    type: z.enum([\"bar\", \"line\", \"area\", \"pie\"]).describe(\"Type of chart\"),\n    title: z.string(),\n    xKey: z.string().describe(\"Key for x-axis or category\"),\n    yKeys: z.array(z.string()).describe(\"Key(s) for y-axis values this is typically the quantitative column\"),\n    multipleLines: z.boolean().describe(\"For line charts only: whether the chart is comparing groups of data.\").optional(),\n    measurementColumn: z.string().describe(\"For line charts only: key for quantitative y-axis column to measure against (eg. values, counts etc.)\").optional(),\n    lineCategories: z.array(z.string()).describe(\"For line charts only: Categories used to compare different lines or data series. Each category represents a distinct line in the chart.\").optional(),\n    colors: z\n      .record(\n        z.string().describe(\"Any of the yKeys\"),\n        z.string().describe(\"Color value in CSS format (e.g., hex, rgb, hsl)\"),\n      )\n      .describe(\"Mapping of data keys to color values for chart elements\")\n      .optional(),\n    legend: z.boolean().describe(\"Whether to show legend\"),\n  })\n  .describe(\"Chart configuration object\");\n\n\nexport type Config = z.infer<typeof configSchema>;\n"],"names":[],"mappings":";;;;;AAAA;;AAeO,MAAM,oBAAoB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oIAAA,CAAA,IAAC,CAAC,MAAM;IACjB,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM;AACvB;AACO,MAAM,qBAAqB,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC;AAKnC,MAAM,eAAe,oIAAA,CAAA,IAAC,CAC1B,MAAM,CAAC;IACN,aAAa,oIAAA,CAAA,IAAC,CACX,MAAM,GACN,QAAQ,CACP;IAEJ,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,MAAM,oIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAO;QAAQ;QAAQ;KAAM,EAAE,QAAQ,CAAC;IACtD,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM;IACf,MAAM,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,OAAO,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,oIAAA,CAAA,IAAC,CAAC,MAAM,IAAI,QAAQ,CAAC;IACpC,eAAe,oIAAA,CAAA,IAAC,CAAC,OAAO,GAAG,QAAQ,CAAC,wEAAwE,QAAQ;IACpH,mBAAmB,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC,yGAAyG,QAAQ;IACxJ,gBAAgB,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,oIAAA,CAAA,IAAC,CAAC,MAAM,IAAI,QAAQ,CAAC,2IAA2I,QAAQ;IAChM,QAAQ,oIAAA,CAAA,IAAC,CACN,MAAM,CACL,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC,qBACpB,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC,oDAErB,QAAQ,CAAC,2DACT,QAAQ;IACX,QAAQ,oIAAA,CAAA,IAAC,CAAC,OAAO,GAAG,QAAQ,CAAC;AAC/B,GACC,QAAQ,CAAC","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///Users/balasubramanian/Desktop/mercury-ai-genie/app/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { Config, configSchema, explanationsSchema, Result } from \"@/lib/types\";\nimport { openai } from \"@ai-sdk/openai\";\nimport { createClient } from \"@vercel/postgres\";\nimport { generateObject } from \"ai\";\nimport { z } from \"zod\";\n\nexport const generateQuery = async (input: string) => {\n  \"use server\";\n  try {\n    const result = await generateObject({\n      model: openai(\"gpt-4o\"),\n      system: `You are a SQL (postgres) and data visualization expert. Your job is to help the user write a SQL query to retrieve the data they need. The database schema is as follows:\n\n      users (\n        user_id bigint PRIMARY KEY,\n        first_name text NOT NULL,\n        last_name text NOT NULL,\n        email text NOT NULL UNIQUE,\n        phone text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      clients (\n        client_id bigint PRIMARY KEY,\n        advisor_id bigint NOT NULL REFERENCES users(user_id),\n        first_name text NOT NULL,\n        last_name text NOT NULL,\n        email text,\n        phone text,\n        date_of_birth date,\n        address text,\n        city text,\n        state text,\n        postal_code text,\n        country text,\n        risk_profile text DEFAULT 'balanced',\n        financial_goal text,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      portfolios (\n        portfolio_id bigint PRIMARY KEY,\n        client_id bigint NOT NULL REFERENCES clients(client_id),\n        name text NOT NULL,\n        portfolio_type text DEFAULT 'investment',\n        risk_level text DEFAULT 'medium',\n        total_value numeric(18,4) DEFAULT 0.00,\n        inception_date date DEFAULT CURRENT_DATE,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      investments (\n        investment_id bigint PRIMARY KEY,\n        portfolio_id bigint NOT NULL REFERENCES portfolios(portfolio_id),\n        asset_name text NOT NULL,\n        asset_type text NOT NULL,\n        ticker_symbol text,\n        quantity numeric(18,4) NOT NULL DEFAULT 0.00,\n        average_purchase_price numeric(18,4) NOT NULL DEFAULT 0.00,\n        current_price numeric(18,4) NOT NULL DEFAULT 0.00,\n        market_value numeric(18,4) GENERATED ALWAYS AS (quantity * current_price) STORED,\n        allocation_percentage numeric(5,2) DEFAULT 0.00,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      Only retrieval queries are allowed. When joining tables, use proper aliases for clarity.\n      For market value calculations, use the market_value column from investments table.\n      For portfolio total value, you can either use the total_value from portfolios or sum up market_value from investments.\n      When dealing with dates, use proper date formatting functions.\n      Always include ORDER BY and LIMIT clauses when appropriate.\n      `,\n      prompt: `Generate the query necessary to retrieve the data the user wants: ${input}`,\n      schema: z.object({\n        query: z.string(),\n      }),\n    });\n    return result.object.query;\n  } catch (e) {\n    console.error(e);\n    throw new Error(\"Failed to generate query\");\n  }\n};\n\nexport const runGenerateSQLQuery = async (query: string) => {\n  \"use server\";\n  // Check if the query is a SELECT statement\n  if (\n    !query.trim().toLowerCase().startsWith(\"select\") ||\n    query.trim().toLowerCase().includes(\"drop\") ||\n    query.trim().toLowerCase().includes(\"delete\") ||\n    query.trim().toLowerCase().includes(\"insert\") ||\n    query.trim().toLowerCase().includes(\"update\") ||\n    query.trim().toLowerCase().includes(\"alter\") ||\n    query.trim().toLowerCase().includes(\"truncate\") ||\n    query.trim().toLowerCase().includes(\"create\") ||\n    query.trim().toLowerCase().includes(\"grant\") ||\n    query.trim().toLowerCase().includes(\"revoke\")\n  ) {\n    throw new Error(\"Only SELECT queries are allowed\");\n  }\n\n  let data: any;\n  try {\n    const client = createClient();\n    await client.connect();\n    data = await client.query(query);\n    await client.end();\n  } catch (e: any) {\n    console.error(\"Database query error:\", e);\n    throw new Error(\"Failed to execute query: \" + e.message);\n  }\n\n  return data.rows as Result[];\n};\n\nexport const explainQuery = async (input: string, sqlQuery: string) => {\n  \"use server\";\n  try {\n    const result = await generateObject({\n      model: openai(\"gpt-4o\"),\n      schema: z.object({\n        explanations: explanationsSchema,\n      }),\n      system: `You are a SQL (postgres) expert. Your job is to explain to the user the SQL query you wrote to retrieve the data they asked for. The database schema is as follows:\n\n      users (\n        user_id bigint PRIMARY KEY,\n        first_name text NOT NULL,\n        last_name text NOT NULL,\n        email text NOT NULL UNIQUE,\n        phone text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      clients (\n        client_id bigint PRIMARY KEY,\n        advisor_id bigint NOT NULL REFERENCES users(user_id),\n        first_name text NOT NULL,\n        last_name text NOT NULL,\n        email text,\n        phone text,\n        date_of_birth date,\n        address text,\n        city text,\n        state text,\n        postal_code text,\n        country text,\n        risk_profile text DEFAULT 'balanced',\n        financial_goal text,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      portfolios (\n        portfolio_id bigint PRIMARY KEY,\n        client_id bigint NOT NULL REFERENCES clients(client_id),\n        name text NOT NULL,\n        portfolio_type text DEFAULT 'investment',\n        risk_level text DEFAULT 'medium',\n        total_value numeric(18,4) DEFAULT 0.00,\n        inception_date date DEFAULT CURRENT_DATE,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      investments (\n        investment_id bigint PRIMARY KEY,\n        portfolio_id bigint NOT NULL REFERENCES portfolios(portfolio_id),\n        asset_name text NOT NULL,\n        asset_type text NOT NULL,\n        ticker_symbol text,\n        quantity numeric(18,4) NOT NULL DEFAULT 0.00,\n        average_purchase_price numeric(18,4) NOT NULL DEFAULT 0.00,\n        current_price numeric(18,4) NOT NULL DEFAULT 0.00,\n        market_value numeric(18,4) GENERATED ALWAYS AS (quantity * current_price) STORED,\n        allocation_percentage numeric(5,2) DEFAULT 0.00,\n        notes text,\n        created_at timestamp with time zone,\n        updated_at timestamp with time zone\n      );\n\n      When you explain you must take a section of the query, and then explain it. Each \"section\" should be unique. So in a query like: \"SELECT * FROM portfolios p JOIN clients c ON p.client_id = c.client_id LIMIT 5\", the sections could be \"SELECT *\", \"FROM portfolios p\", \"JOIN clients c ON p.client_id = c.client_id\", \"LIMIT 5\".\n      If a section doesn't have any explanation, include it, but leave the explanation empty.\n      `,\n      prompt: `Explain the SQL query you generated to retrieve the data the user wanted. Assume the user is not an expert in SQL. Break down the query into steps. Be concise.\n\n      User Query:\n      ${input}\n\n      Generated SQL Query:\n      ${sqlQuery}`,\n    });\n    return result.object;\n  } catch (e) {\n    console.error(e);\n    throw new Error(\"Failed to generate query\");\n  }\n};\n\nexport const generateChartConfig = async (\n  results: Result[],\n  userQuery: string\n) => {\n  \"use server\";\n  const system = `You are a data visualization expert. `;\n\n  try {\n    const { object: config } = await generateObject({\n      model: openai(\"gpt-4o\"),\n      system,\n      prompt: `Given the following data from a SQL query result, generate the chart config that best visualises the data and answers the users query.\n      For multiple groups use multi-lines.\n\n      Here is an example complete config:\n      export const chartConfig = {\n        type: \"pie\",\n        xKey: \"month\",\n        yKeys: [\"sales\", \"profit\", \"expenses\"],\n        colors: {\n          sales: \"#4CAF50\",    // Green for sales\n          profit: \"#2196F3\",   // Blue for profit\n          expenses: \"#F44336\"  // Red for expenses\n        },\n        legend: true\n      }\n\n      User Query:\n      ${userQuery}\n\n      Data:\n      ${JSON.stringify(results, null, 2)}`,\n      schema: configSchema,\n    });\n\n    const colors: Record<string, string> = {};\n    config.yKeys.forEach((key, index) => {\n      colors[key] = `hsl(var(--chart-${index + 1}))`;\n    });\n\n    const updatedConfig: Config = { ...config, colors };\n    return { config: updatedConfig };\n  } catch (e) {\n    // @ts-expect-errore\n    console.error(e.message);\n    throw new Error(\"Failed to generate chart suggestion\");\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 400, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 466, "column": 0}, "map": {"version":3,"sources":["file:///Users/balasubramanian/Desktop/mercury-ai-genie/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","debugId":null}},
    {"offset": {"line": 480, "column": 0}, "map": {"version":3,"sources":["file:///Users/balasubramanian/Desktop/mercury-ai-genie/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA4P,GACzR,0BACA","debugId":null}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}